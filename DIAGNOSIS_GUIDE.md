# ðŸ”§ TWIST_CMG è®­ç»ƒè¯Šæ–­æŒ‡å—

## é—®é¢˜æ¦‚è¿°
åœ¨ CMG æ¨¡å¼ä¸‹è®­ç»ƒæ•™å¸ˆç½‘ç»œï¼Œåœ¨çº¦ 2000 æ­¥è¿­ä»£åŽï¼Œæœºå™¨äººåœæ­¢è¿åŠ¨ï¼ˆ"å¼ å¼€è…¿ç­‰æ­»"ï¼‰ã€‚

## å¿«é€Ÿè¯Šæ–­æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šæ”¶é›†åŸºç¡€è¯Šæ–­æ•°æ®ï¼ˆ5åˆ†é’Ÿï¼‰

**è¿è¡Œå¿«é€Ÿè¯Šæ–­è„šæœ¬**ï¼š
```bash
cd /home/eziothean/TWIST_CMG
bash quick_diagnose.sh
```

è¿™ä¼šï¼š
- è¿è¡Œ50æ­¥è®­ç»ƒ
- è®°å½•æ‰€æœ‰è°ƒè¯•ä¿¡æ¯åˆ° `/tmp/cmg_diagnosis.log`
- è‡ªåŠ¨æå–å…³é”®æŒ‡æ ‡

**é¢„æœŸè¾“å‡ºç¤ºä¾‹**ï¼š
```
ã€RESET æ—¶é—´ä¿¡æ¯ã€‘
[DEBUG RESET] é‡ç½®çŽ¯å¢ƒå‚è€ƒå€¼:
  motion_times[0]: 1.2340s
  _motion_time_offsets[env_ids[0]]: 1.2340s
  dof_pos@reset[env_ids[0], :6]: [0.5, -0.1, 0.0, 0.5, 0.3, 0.0]

ã€Step 1 å‚è€ƒæ£€æŸ¥ã€‘
[DEBUG Step 1] å‚è€ƒåŠ¨ä½œæ£€æŸ¥:
  motion_time: 1.2340s  â† âš ï¸ åº”è¯¥å’Œ RESET ç›¸åŒï¼
  _ref_dof_pos[0, :6]: [0.5, -0.1, 0.0, 0.5, 0.3, 0.0]
  ...
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥å‚è€ƒæ˜¯å¦å¯è¾¾ï¼ˆ2åˆ†é’Ÿï¼‰

**æ£€æŸ¥ CMG ç”Ÿæˆçš„å‚è€ƒå…³èŠ‚èŒƒå›´**ï¼š
```bash
cd /home/eziothean/TWIST_CMG
python check_cmg_feasibility.py
```

**å¯èƒ½çš„è¾“å‡º**ï¼š
```
âœ“ æ‰€æœ‰å…³èŠ‚éƒ½åœ¨åˆç†èŒƒå›´å†…!
  â†’ CMG ç”Ÿæˆçš„å‚è€ƒåº”è¯¥æ˜¯ç‰©ç†ä¸Šå¯è¾¾çš„

æˆ–è€…

âŒ å‘çŽ° 3 ä¸ªå…³èŠ‚è¶…å‡ºèŒƒå›´!
  [12] waist_yaw: [3.2000, 3.5000]  (allowed: [-1.57, 1.57])
  â†’ æœºå™¨äººæ— æ³•è¾¾åˆ°è¿™äº›å‚è€ƒè§’åº¦
  â†’ è¿™å¯èƒ½å¯¼è‡´ reward å§‹ç»ˆä¸º0
```

**å¦‚æžœæœ‰è¶…å‡ºèŒƒå›´çš„å…³èŠ‚ â†’ è¿™å¯èƒ½å°±æ˜¯æ ¹æœ¬åŽŸå› ï¼**

### ç¬¬ä¸‰æ­¥ï¼šåˆ†æž Reward æ›²çº¿ï¼ˆ3åˆ†é’Ÿï¼‰

**æŸ¥çœ‹å®Œæ•´çš„è¯Šæ–­æ—¥å¿—**ï¼š
```bash
cat /tmp/cmg_diagnosis.log | grep "tracking_joint_dof\|tracking_joint_vel\|TOTAL"
```

**æŸ¥æ‰¾é—®é¢˜æ¨¡å¼**ï¼š

âŒ **æ¨¡å¼1ï¼šReward å§‹ç»ˆå¾ˆå°**
```
[DEBUG Step 1] tracking_joint_dof: 0.001234 (Ã—0.8400)
[DEBUG Step 2] tracking_joint_dof: 0.001289 (Ã—0.8400)
```
â†’ è¡¨ç¤ºå‚è€ƒä¸å¯è¾¾ï¼ˆè”ç³»"æ£€æŸ¥å‚è€ƒæ˜¯å¦å¯è¾¾"æ­¥éª¤ï¼‰

âŒ **æ¨¡å¼2ï¼šReward ä»Žç¬¬ä¸€æ­¥å°±å¾ˆå°**
```
[DEBUG Step 1] _ref_dof_pos[0, :6]: [0.5, -0.1, 0.0, 0.5, 0.3, 0.0]
[DEBUG Step 1] dof_pos[0, :6]:      [0.2, -0.13, -0.46, 0.1, 0.26, -0.2]
å·®å¼‚: [-0.3, -0.03, -0.46, -0.4, -0.04, -0.2]
```
â†’ åˆå§‹åŒ–åŒæ­¥é—®é¢˜ï¼ˆå·®å¼‚ > 0.3 rad å°±å¾ˆå¤§ï¼‰

âŒ **æ¨¡å¼3ï¼šæ—¶é—´ä¸åŒæ­¥**
```
[DEBUG RESET] motion_times[0]: 1.2340s
[DEBUG Step 1] motion_time: 1.2340s  â† å¯¹çš„
[DEBUG Step 1] _ref_dof_pos[0, :6]: [0.5, -0.1, 0.0, 0.5, 0.3, 0.0]
              BUT CMG å‚è€ƒåœ¨ t=1.2340s æ—¶åº”è¯¥æ˜¯è¿™äº›å€¼
              å®žé™…ä¸Šæœºå™¨äººè¢«è®¾ç½®åˆ°äº†ä¸åŒçš„å€¼ â† æ—¶é—´åŒæ­¥é—®é¢˜
```

## è¯Šæ–­ç»“æžœä¸Žå¯¹åº”ä¿®å¤

### ç»“æžœ1ï¼šå‚è€ƒå…³èŠ‚è¶…å‡ºèŒƒå›´ âŒ
```bash
# ä¿®å¤ï¼šé™åˆ¶å‚è€ƒåˆ°å®‰å…¨èŒƒå›´
# ç¼–è¾‘ pose/utils/motion_lib_cmg.py ç¬¬ 209 è¡ŒåŽæ·»åŠ ï¼š
self.dof_pos_pool = torch.clamp(self.dof_pos_pool, -2.5, 2.5)
```

### ç»“æžœ2ï¼šåˆå§‹åŒ–åŒæ­¥å·®å¼‚å¤§ âš ï¸
```bash
# ä¿®å¤1ï¼šç¦ç”¨éšæœºé‡ç½®
# ç¼–è¾‘ g1_mimic_distill_config.py ç¬¬ 46 è¡Œï¼š
rand_reset = False

# ä¿®å¤2ï¼šç¡®ä¿é‡ç½®æ—¶æœºå™¨äººå®Œå…¨åŒæ­¥
# åœ¨ reset_idx åŽæ‰‹åŠ¨éªŒè¯
```

### ç»“æžœ3ï¼šReward å§‹ç»ˆå¾ˆå° ðŸ”´
```bash
# ä¿®å¤ï¼šå¢žåŠ åˆæœŸæƒé‡
# ç¼–è¾‘ g1_mimic_distill_config.py ç¬¬ 219-220 è¡Œï¼š
tracking_joint_dof = 1.2  # ä»Ž 0.84 å¢žåŠ 
tracking_joint_vel = 0.4   # ä»Ž 0.28 å¢žåŠ 
```

## å®Œæ•´è¯Šæ–­æ¸…å•

è¿è¡Œè¯Šæ–­åŽï¼Œç¡®è®¤ä»¥ä¸‹ä¿¡æ¯ï¼š

```
â–¡ åˆ›å»ºè¯Šæ–­æ—¥å¿—: /tmp/cmg_diagnosis.log
â–¡ æŸ¥çœ‹ RESET æ—¶é—´æˆ³
â–¡ æŸ¥çœ‹ Step 1 æ—¶é—´æˆ³ï¼ˆåº”è¯¥ç›¸åŒï¼‰
â–¡ æŸ¥çœ‹å‚è€ƒDOFå€¼ vs å®žé™…DOFå€¼çš„å·®å¼‚
â–¡ è¿è¡Œ check_cmg_feasibility.py
â–¡ æ£€æŸ¥æ˜¯å¦æœ‰å…³èŠ‚è¶…å‡ºèŒƒå›´
â–¡ æå– reward åˆ†è§£ä¿¡æ¯
â–¡ æ£€æŸ¥ reward æ˜¯å¦åœ¨ç¬¬ä¸€æ­¥å°±å¾ˆå°
â–¡ ç¡®è®¤ _motion_time_offsets æ˜¯å¦è¢«æ­£ç¡®è®¾ç½®
â–¡ æŸ¥çœ‹ actions å€¼æ˜¯å¦åˆç†
```

## æ·±åº¦åˆ†æžï¼ˆå¦‚æžœå¿«é€Ÿè¯Šæ–­ä¸å¤Ÿï¼‰

### 1. å®Œæ•´è®­ç»ƒæ—¥å¿—åˆ†æž
```bash
# è¿è¡Œå®Œæ•´çš„è®­ç»ƒï¼ˆå¯èƒ½éœ€è¦1å°æ—¶+ï¼‰
cd /home/eziothean/TWIST_CMG
bash train_teacher.sh test_diagnosis_full cuda:0 256 normal 2>&1 | tee /tmp/full_training.log

# æå– reward æ›²çº¿
grep "episode_sums\|reward" /tmp/full_training.log > /tmp/reward_curve.txt

# ä½¿ç”¨Pythonç»˜å›¾
python3 << 'EOF'
import re
rewards = {}
with open('/tmp/reward_curve.txt') as f:
    for line in f:
        # è§£æžå¹¶ç»˜åˆ¶
        pass
EOF
```

### 2. æ¯”è¾ƒ Mocap å’Œ CMG æ¨¡å¼
å¦‚æžœé¡¹ç›®ä¸­æœ‰ Mocap æ•°æ®ï¼Œä¸´æ—¶åˆ‡æ¢åˆ° Mocap æ¨¡å¼ï¼š
```python
# ä¸´æ—¶æ”¹ä¸ºä½¿ç”¨ MotionLibPkl è€Œä¸æ˜¯ MotionLibCMG
# æ£€æŸ¥è¡Œä¸ºæ˜¯å¦ç›¸åŒ
# å¦‚æžœ Mocap æ¨¡å¼æ­£å¸¸ â†’ é—®é¢˜ç¡®å®žåœ¨ CMG
```

### 3. PD è¿½è¸ªæµ‹è¯•
```bash
# ä¸ä½¿ç”¨ç­–ç•¥ç½‘ç»œï¼Œè®©PDæŽ§åˆ¶å™¨ç›´æŽ¥è¿½è¸ªCMGå‚è€ƒ
# æ£€æŸ¥æ˜¯å¦èƒ½æˆåŠŸè·Ÿè¸ª
python test_pd_tracking.py
```

## å¸¸è§é—®é¢˜

**Q: è¯Šæ–­è„šæœ¬è¯´æ‰¾ä¸åˆ° CMG æ¨¡åž‹ï¼Ÿ**
A: ç¡®ä¿ `/home/eziothean/TWIST_CMG/CMG_Ref/` ä¸­æœ‰ `model.pt` å’Œ `data.pt` æ–‡ä»¶

**Q: å¿«é€Ÿè¯Šæ–­è¿è¡Œäº†ä½†æ²¡æœ‰çœ‹åˆ°è°ƒè¯•è¾“å‡ºï¼Ÿ**
A: æ£€æŸ¥ï¼š
- æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„ configï¼ˆåº”è¯¥æ˜¯ `model=teacher`ï¼‰
- è°ƒè¯•è¾“å‡ºæ˜¯å¦è¢« print buffer å»¶è¿Ÿäº†ï¼ˆåŠ  `flush=True`ï¼‰
- æ˜¯å¦åœ¨æ­£ç¡®çš„æ–‡ä»¶ä¸­æ·»åŠ äº†è°ƒè¯•ä»£ç 

**Q: å‚è€ƒè¯´è¶…å‡ºèŒƒå›´ï¼Œä½†æˆ‘ç¡®å®šCMGæ¨¡åž‹æ˜¯å¯¹çš„ï¼Ÿ**
A: è¿™é€šå¸¸è¡¨ç¤ºï¼š
- CMG æ¨¡åž‹åœ¨è®­ç»ƒæ—¶ä½¿ç”¨äº†ä¸åŒçš„èŒƒå›´
- æˆ–è€…å…³èŠ‚å®šä¹‰ä¸åŒæ­¥
- æ£€æŸ¥ CMG_Ref/dataloader ä¸­çš„å…³èŠ‚å®šä¹‰

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. **ç«‹å³è¿è¡Œ**: `bash quick_diagnose.sh`
2. **æŸ¥çœ‹ç»“æžœ**: æ£€æŸ¥ `/tmp/cmg_diagnosis.log`
3. **æ ¹æ®ç»“æžœ**ï¼š
   - å¦‚æžœå‚è€ƒè¶…å‡ºèŒƒå›´ â†’ åº”ç”¨ä¿®å¤1
   - å¦‚æžœåˆå§‹åŒ–å·®å¼‚å¤§ â†’ åº”ç”¨ä¿®å¤2
   - å¦‚æžœrewardå¾ˆå° â†’ åº”ç”¨ä¿®å¤3
4. **é‡æ–°è®­ç»ƒ**: éªŒè¯ä¿®å¤æ˜¯å¦æœ‰æ•ˆ
5. **æŠ¥å‘Šç»“æžœ**: æäº¤è¯Šæ–­æ—¥å¿—å’Œä¿®å¤ä¿¡æ¯

---

å¦‚æœ‰ä»»ä½•é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†çš„è¯Šæ–­æ–‡æ¡£ï¼š
- `DIAGNOSIS_SUMMARY.md` - å®Œæ•´çš„è¯Šæ–­æ€»ç»“
- `DIAGNOSIS_PLAN.md` - è¯¦ç»†çš„è¯Šæ–­è®¡åˆ’
- `DEBUG_REPORT.md` - è°ƒè¯•æŠ¥å‘Š

